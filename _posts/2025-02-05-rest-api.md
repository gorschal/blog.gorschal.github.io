---
layout: post
title: Немного про RESTful API
excerpt_separator: <!--more-->
categories:
  - Разработка
tags:
  - api
  - design
---

Как правильно проектировать API? На самом деле нет ни одной официальной спецификации, которая отвечает на этот вопрос. Но, тем не менее, хорошо разработанный API прост в понимании, использовании и обслуживании. Он должен соответствовать согласованным стилевым решениям, включать встроенные механизмы безопасности для аутентификации и шифрования данных и надежно обрабатывать большие объемы трафика. Ниже попробую дать несколько советов, как этого достичь.

<!--more-->

## Дизайн URI 

В архитектуре RESTful API URL-адреса обычно служат для представления ресурсов (объектов), в то время как методы __HTTP__ (такие как __GET__, __POST__, __PUT__ и __DELETE__) отражают операции, которые можно выполнять над этими ресурсами. Такой подход к разработке акцентирует внимание на состоянии и представлении ресурсов, а не на конкретных действиях.

### Объект должен быть существительным
В процессе разработки __API URL__ (Uniform Resource Locator) обычно выступает в роли ресурса, который является объектом __HTTP__-глагола. Согласно принципам __RESTful__ проектирования, URL-адреса должны быть существительными, а не глаголами, поскольку они обозначают набор «ресурсов» или отдельный экземпляр, а не действие.

```sh
# Плохо
/getAllCars
/createNewCar
/deleteAllRedCars

# Хорошо
/allCars
/newCar
/allRedCars
```

### URL-адреса в множественном числе

При формировании __URL__-адресов настоятельно рекомендуется использовать форму множественного числа. Это связано с тем, что такие адреса обычно представляют собой коллекции ресурсов, а использование множественного числа позволяет сохранить единообразие и ясность в их структуре.

Даже если вы указываете на один конкретный ресурс, использование множественного числа остается предпочтительным. Например, __/users/123__ будет представлять пользователя с идентификатором __123__, что обеспечит согласованность всех __URL__-адресов.
Если ресурсы имеют иерархическую структуру, то __URL__-адрес должен отражать эту взаимосвязь. Например, __/users/123/posts__ может означать коллекцию записей, созданных пользователем с идентификатором __123__.

### Избегайте сложных вложенных URL-адресов
Часто ресурсы требуют многоуровневой классификации, что приводит к созданию сложных и запутанных URL-адресов. Например, чтобы найти статьи конкретной категории определённого автора, вам может потребоваться следующий путь:

```sh
GET /authors/12/categories/2
```

Очень субъективно, но по мне лучше когда используются параметры запросов. 

```sh
GET /authors/12?categories=2
```

Не создавайте беспорядочный API. Не следует помещать все функции в один endpoint. Если вам сложно распределить функции по разным URL-адресам, вы можете обратиться и придерживаться принципов [DDD](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%B5%D0%B4%D0%BC%D0%B5%D1%82%D0%BD%D0%BE-%D0%BE%D1%80%D0%B8%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5).

1. Системы маленькие по размеру
2. Системы очень простые
3. Есть кристально чёткие границы систем

## Коды состояния

На каждый запрос клиента сервер должен отвечать кодом состояния HTTP и соответствующими данными. Код состояния HTTP представляет собой трехзначное число, которое можно разделить на пять категорий:

* __1xx:__ Информация
* __2xx:__ Успех
* __3xx:__ Перенаправление
* __4xx:__ Ошибки клиента
* __5xx:__ Ошибки сервера

Эти пять категорий включают более 100 кодов состояния, которые охватывают большинство возможных ситуаций. Каждый код состояния имеет стандартное или общепринятое значение, что позволяет клиенту понять, что произошло, просто взглянув на код. Поэтому сервер должен возвращать максимально точный код состояния.

Не буду описывать здесь все эти коды. Вы их можете с легкостью нагуглить.

## Ответы сервера

Вы помните, что ответ должен быть JSON, в редких случаях XML. Не забываем использовать для заголовка __Content-Type__ и он должен быть __application/json__. Клиент также должен указать, что он принимает ответы JSON, установив заголовок __Accept__ в своем запросе:
 
```sh
GET /orders/2 HTTP/1.1
Accept: application/json
```

Код состояния должен четко указывать на результат запроса. В случае возникновения ошибок следует использовать соответствующие коды состояния, а более подробная информация содержится в тексте ответа.

```sh
HTTP/1.1 400 Bad Request
Content-Type: application/json
{
  "error": "Invalid payload.",
}
```

## Используйте HAL (языка гипертекстовых приложений)

__HAL__ — это широко известный формат гипермедиа, который наглядно демонстрирует связи между различными ресурсами.

```sh
{
  "id": 1,
  "name": "Example",
  "links": {
    "self": "http://api.example.com/resource/1",
    "related": "http://api.example.com/resource/2"
  }
}
```

## Верните созданный ресурс но не возвращайте содержимое

Отвечайте только кодом __201 Created__ или __204 No Content__ с заголовком __Location__, не предоставляя информацию о самом ресурсе. Такой подход минимизирует объём передаваемых данных и даёт клиенту возможность решить, стоит ли запрашивать ресурс позже.

```sh
HTTP/1.1 201 Created
Location: /resources/123
```

## Документирование API

Это очень важный момент, который часто упускают из виду, особенно если __API__ не является общедоступным. Не стоит недооценивать __Swagger__ или __ReDoc__. Лично мне больше по душе __ReDoc__.

## Версионность

__API__ — это как живой организм: в нём постоянно появляются новые функции, а устаревшие исчезают. Как только вы теряете обратную совместимость, важно зафиксировать версию продукта. Особенно если ваше __API__ является публичным.